#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <sys/time.h>
#include <string.h>
#include <unistd.h>
#include <sys/select.h>
#include <termios.h>
#include <windows.h>

#include "engine/engine.h"

int loading_screen[] = {
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,
    0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,
    0,0,0,0,2,2,2,2,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,0,0,2,0,0,0,0,2,2,2,0,0,0,0,2,2,2,2,2,0,0,2,2,2,2,0,0,0,0,0,
    0,0,1,0,0,0,2,0,0,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,0,2,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,0,0,0,0,2,0,0,0,2,0,1,0,0,
    0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,
    0,0,1,0,0,0,2,0,0,0,0,2,2,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,0,0,0,2,0,0,0,2,0,1,0,0,
    0,0,0,0,0,0,2,0,0,0,0,2,0,2,0,2,0,0,2,0,0,0,2,0,0,2,2,2,2,2,0,0,2,0,0,0,2,0,0,2,2,2,2,2,0,0,2,2,2,2,0,0,0,0,0,
    0,0,1,0,0,0,2,0,0,0,0,2,0,0,2,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,0,0,0,2,0,0,0,2,0,1,0,0,
    0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,2,0,0,2,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,
    0,0,1,0,0,0,2,0,0,0,0,2,0,0,0,2,0,0,0,2,0,2,0,0,0,2,0,0,0,2,0,0,2,0,0,2,0,0,0,2,0,0,0,0,0,0,2,0,0,0,2,0,1,0,0,
    0,0,0,0,2,2,2,2,2,0,0,2,0,0,0,2,0,0,0,0,2,0,0,0,0,2,0,0,0,2,0,0,2,2,2,0,0,0,0,2,2,2,2,2,0,0,2,0,0,0,2,0,0,0,0,
    0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,
    0,0,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};  // 55 * 17

int bLoop = 1;
int nFSM = 0;
int nStep = 0;

void gameStart_Title()
{
	//name
	//version
	int i = 0;
	switch(nStep) {
		case 0:
		if (i == 0) {
			draw_mainTitle(loading_screen);
			nStep = 1;
			break;

		}
		case 1:
		if (kbhit() != 0) {
			char ch = getch();
			nFSM = 1;
			nStep = 0;
		}
		break;

	}

}

////////////////////
void gameStart_Play()
{
    switch(nStep) {
        case 0:
			nStep++;
			system("clear");
			break;
		case 1:	
			if(kbhit() != 0) {
				char ch = getch();
				if(ch == 'q') {
					bLoop = 0;
				}
                /*
				else if (ch == 'j') {
					car_pos_x -= 1;
				}
				else if (ch == 'l') {
					car_pos_x += 1;
				}
                */
			
			}

    }

}


struct timespec work_timer;
double acc_tick,last_tick;

int main()
{
    set_conio_terminal_mode();
	acc_tick = last_tick = 0;
	system("clear");

 	while(bLoop) {
		clock_gettime(CLOCK_MONOTONIC,&work_timer);
		double cur_tick = work_timer.tv_sec + 
			(double)(work_timer.tv_nsec * 1e-9);
		double delta_tick = cur_tick - last_tick;
		last_tick = cur_tick;

		if(nFSM == 0) {
			gameStart_Title(delta_tick);

		}
		else if(nFSM == 1 ) { 
			gameStart_Play(delta_tick);
		}

	}
   
    return 0;
}